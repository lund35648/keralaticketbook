<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kerala Government Ticket</title>

<!-- Meta Pixel (kept) -->
<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '744008402087520');
fbq('track', 'PageView');
</script>
<noscript>
<img height="1" width="1" style="display:none"
 src="https://www.facebook.com/tr?id=744008402087520&ev=PageView&noscript=1"/>
</noscript>

<style>
/* ---------- RESET & LAYOUT ---------- */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;width:100%;margin:0;padding:0}
body{
  font-family:Arial,Helvetica,sans-serif;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  background:#f4f4f4;
  color:#222;
  line-height:1.35;
  overflow-x:hidden;
}

/* ---------- HEADER FULL WIDTH (center logos) ---------- */
.header{
  width:100vw;
  left:0;
  background:#e2e7cd;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:10px 16px;
  gap:12px;
  border-bottom:2px solid rgba(0,0,0,0.06);
  position:relative;
  box-shadow:0 3px 8px rgba(0,0,0,0.06);
}
.header .logo-container{ display:flex; align-items:center; gap:14px; min-width:0; justify-content:center; }
.header .logo-container img{ height:56px; width:auto; object-fit:contain; display:block; }
.header h1{ font-size:16px; color:#0f3b2f; margin-left:6px; font-weight:800; white-space:nowrap; }

@media (max-width:540px){
  .header{ flex-direction:row; align-items:center; padding:10px; gap:8px; }
  .header .logo-container img{ height:42px; }
  .header h1{ font-size:14px; }
}

/* ---------- PAGE WRAP (center content) ---------- */
.page-wrap{
  max-width:1100px;
  margin:0 auto;
  padding:12px 14px;
}

/* ---------- CARD / CONTAINER ---------- */
.container{
  width:100%;
  max-width:420px;
  margin:18px auto;
  background:#fff;
  border-radius:14px;
  box-shadow:0 6px 20px rgba(0,0,0,0.08);
  overflow:hidden;
}

/* ---------- TOP IMAGE: make it fit container without cropping ---------- */
.topLogo{ width:100%; height:230px; overflow:hidden; position:relative; background:#ddd; display:flex; align-items:center; justify-content:center; padding:6px; }
.topLogo img{
  max-width:100%;
  max-height:100%;
  object-fit:contain;
  display:block;
  border-radius:6px;
  box-shadow: inset 0 0 40px rgba(0,0,0,0.03);
}

/* keep livePop below image and not overlapping */
.livePopWrap{ padding:10px 14px; background:transparent; display:flex; justify-content:center; }
.livePop{
  display:inline-block;
  padding:8px 14px;
  border-radius:20px;
  background:linear-gradient(90deg,#2ecc71,#27ae60);
  color:#fff;
  font-size:13px;
  font-weight:800;
  box-shadow:0 6px 18px rgba(39,174,96,0.12);
  display:flex;
  align-items:center;
  gap:8px;
  animation:livePulse 1.2s ease-in-out infinite;
}
@keyframes livePulse{
  0% { transform: scale(1); box-shadow:0 6px 18px rgba(39,174,96,0.12); opacity:1; }
  50% { transform: scale(1.03); box-shadow:0 12px 30px rgba(39,174,96,0.22); opacity:0.85; }
  100% { transform: scale(1); box-shadow:0 6px 18px rgba(39,174,96,0.12); opacity:1; }
}

/* ---------- FORM / INPUTS ---------- */
.formInner{ padding:14px; }
h2{ text-align:center; margin:8px 0 10px; color:#d9365d; font-size:18px; }
input,select,button,textarea{
  width:100%;
  padding:10px 12px;
  margin-bottom:10px;
  border-radius:8px;
  border:1px solid #ddd;
  font-size:14px;
}
select[multiple]{ min-height:84px; max-height:240px; }
.ticketBox{ border:2px dashed #ff4f79; border-radius:12px; padding:10px; margin-bottom:8px; background:#fffafc; }
.ticketAmount,.ticketTitle{ padding:6px 4px; margin-bottom:6px; }
.ticketAmount{ background:#e8f5e9; color:#1b5e20; border-radius:8px; font-weight:700; text-align:center; }
.ticketTitle{ font-weight:700; color:#d9365d; }
.counter{ font-size:13px; margin-top:3px; color:#666; }
.selectedList, #freeList{ display:flex; flex-wrap:wrap; gap:6px; margin-top:8px; }
.chip{ background:#ffe3ea; color:#d9365d; padding:6px 8px; border-radius:14px; font-size:12px; display:flex; gap:8px; align-items:center; }
.chip span{ cursor:pointer; font-weight:700; padding-left:6px }

/* submit */
button.primary{ background:linear-gradient(90deg,#ff4f79,#d9365d); color:#fff; border:none; font-weight:800; padding:10px; border-radius:10px; }
button.primary:disabled{ opacity:.5; cursor:not-allowed; }

/* hide the green calculation UI visually but keep in DOM for logic */
#ticketAmount, #breakdown{ display:none !important; }

/* ---------- MODAL ---------- */
.modal{ position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; align-items:center; justify-content:center; z-index:9999; padding:12px; }
.modalBox{ background:#fff; width:100%; max-width:520px; border-radius:12px; padding:16px; box-shadow:0 8px 30px rgba(0,0,0,.25); }
.modalBtns{ display:flex; gap:10px; margin-top:12px; }
.cancelBtn{ background:#ccc; color:#333; border:none; padding:10px 12px; border-radius:8px; cursor:pointer; }

/* ---------- SLIDESHOW ---------- */
.slideshow-container{ width:100%; height:180px; overflow:hidden; background:#e2e7cd; border-radius:8px; display:flex; align-items:center; justify-content:center; margin-top:12px; }
.mySlides{ display:none; width:100%; height:100%; text-align:center; }
.mySlides img{ width:100%; height:100%; object-fit:cover; display:block; }

/* ---------- FEEDBACK / WINNER TRACK ---------- */
.lottery-container{ max-width:1000px; margin:18px auto; background:#fff; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.08); overflow:hidden; border:2px solid #0a5a0a; }
.feedback-container{ position:relative; overflow:hidden; }
.feedback-container::before, .feedback-container::after{
  content:''; position:absolute; top:0; bottom:0; width:64px; z-index:2;
}
.feedback-container::before{ left:0; background:linear-gradient(90deg,#fff,transparent); }
.feedback-container::after{ right:0; background:linear-gradient(90deg,transparent,#fff); }
.feedback-track{ display:flex; gap:12px; align-items:flex-start; padding:14px 20px; will-change:transform; }
.feedback-card{ min-width:300px; max-width:340px; background:#fff9e6; border-radius:10px; padding:12px; box-shadow:0 6px 14px rgba(0,0,0,.06); border-top:4px solid #d4af37; flex-shrink:0; }
.winner-badge{ position:absolute; top:-10px; right:12px; background:#e31837; color:#fff; padding:4px 10px; border-radius:12px; font-size:11px; font-weight:700; }
.user-info{ display:flex; align-items:center; gap:12px; margin-bottom:8px; }
.avatar{ width:46px; height:46px; border-radius:50%; background:#f1f1f1; display:flex; align-items:center; justify-content:center; font-weight:700; color:#0a5a0a; border:2px solid #d4af37; }
.user-details h4{ margin:0; color:#0a5a0a; font-size:15px; }
.feedback-text{ font-size:14px; color:#333; margin-bottom:8px; }
.lottery-details{ display:flex; justify-content:space-between; font-size:12px; border-top:1px dashed #ccc; padding-top:10px; color:#333; }
.prize-amount{ color:#e31837; font-weight:800; }

/* control buttons */
.controls{ display:flex; justify-content:center; padding:12px; background:#f8f9fa; gap:12px; }
.control-btn{ background:#0a5a0a; color:#fff; border:none; padding:8px 14px; border-radius:6px; cursor:pointer; font-weight:700; }

/* live-indicator */
.live-indicator{ display:flex; justify-content:center; align-items:center; gap:8px; padding:10px; background:#f8f9fa; color:#333; font-weight:700; }
.live-dot{ width:10px; height:10px; background:#e31837; border-radius:50%; animation:livePulseDot 1.5s infinite; }
@keyframes livePulseDot{ 0%{opacity:1}50%{opacity:.3}100%{opacity:1} }

/* disclaimer */
.disclaimer{ font-size:12px; text-align:center; padding:12px; background:#f8f9fa; color:#555; }

/* whatsapp floating button */
.whatsapp-float{
  position:fixed;
  right:18px;
  bottom:18px;
  z-index:99999;
  width:56px;
  height:56px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(180deg,#25D366,#128C7E);
  box-shadow:0 8px 24px rgba(0,0,0,0.18);
  cursor:pointer;
  text-decoration:none;
}
.whatsapp-float svg{ width:26px; height:26px; display:block; }

/* responsive tweaks */
@media (max-width:640px){
  .topLogo{ height:200px; }
  .feedback-card{ min-width:260px; max-width:290px; }
  .feedback-track{ padding:12px; gap:10px; }
}

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce){
  .feedback-track{ animation:none !important; }
  .live-dot{ animation:none !important; }
  .livePop{ animation:none !important; }
}
</style>
</head>
<body>

<!-- HEADER full width -->
<header class="header" role="banner" aria-label="Main header">
  <div class="logo-container" aria-hidden="false">
    <img src="https://kerelalottery.ct.ws/wp-content/uploads/2025/08/image-removebg-preview-6-e1754205589977.png" alt="G20 Logo">
    <img src="https://kerelalottery.ct.ws/wp-content/uploads/2025/08/top-logo-e1754204463750.png" alt="Kerala Lottery Logo">
  </div>
</header>

<div class="page-wrap">

  <!-- MAIN CARD -->
  <main class="container" role="main" aria-labelledby="ticket-heading">

    <!-- top image enlarged & fit (now contain to show full image) -->
    <div class="topLogo" aria-hidden="false">
      <img src="https://kerelalottery.ct.ws/wp-content/uploads/2026/02/6093555907598946471.jpg" alt="Top banner">
    </div>

    <!-- live booking (separate block; won't overlap image) -->
    <div class="livePopWrap" aria-hidden="false">
      <span class="livePop" role="status" aria-live="polite">ðŸŸ¢ LIVE BOOKING ACTIVE</span>
    </div>

    <!-- FORM -->
    <section class="formInner" aria-labelledby="ticket-heading">
      <h2 id="ticket-heading">Kerala Government Ticket</h2>

      <input id="name" placeholder="Full Name" autocomplete="name" aria-label="Full name" />
      <input id="mobile" placeholder="Mobile Number" inputmode="tel" autocomplete="tel" aria-label="Mobile number" />

      <!-- state select will be populated by JS to ensure custom order -->
      <select id="state" aria-label="Select State">
        <option value="">Select State</option>
      </select>

      <select id="language" aria-label="Select Language">
        <option>English</option>
        <option>Hindi</option>
        <option>Malayalam</option>
        <option>Tamil</option>
        <option>Kannada</option>
        <option>Telugu</option>
      </select>

      <div class="ticketBox" aria-live="polite" aria-atomic="true">
        <div class="ticketAmount" id="ticketAmount">ðŸ’° Total Amount: â‚¹0</div>
        <div class="ticketTitle">ðŸŽŸ Select Lucky Ticket (â‚¹150 per paid ticket)</div>

        <select id="ticket" multiple aria-label="Select tickets"></select>

        <div class="counter" id="counter">Selected: 0 tickets</div>
        <div class="selectedList" id="selectedList" aria-hidden="false"></div>

        <div class="ticketTitle" style="margin-top:10px;">Free Tickets</div>
        <div class="selectedList" id="freeList" aria-hidden="false"></div>
      </div>

      <!-- hidden breakdown kept for logic (visually hidden by CSS) -->
      <div class="ticketAmount" id="breakdown" style="font-size:13px;"></div>

      <input id="amount" placeholder="Total Amount (â‚¹)" readonly aria-label="Total amount" />
      <button id="submitBtn" class="primary" disabled aria-disabled="true">Submit & Continue</button>
    </section>
  </main>

  <!-- modal preview -->
  <div class="modal" id="previewModal" role="dialog" aria-modal="true" aria-labelledby="previewTitle">
    <div class="modalBox">
      <h3 id="previewTitle">Payment Preview</h3>
      <div class="summary" id="previewContent" style="white-space:pre-wrap; font-size:14px; color:#111;"></div>
      <div class="modalBtns">
        <button class="cancelBtn" onclick="closePreview()">Cancel</button>
        <button onclick="proceedWhatsApp()" class="primary">Confirm & WhatsApp</button>
      </div>
    </div>
  </div>

  <!-- optional slideshow -->
  <div class="slideshow-container" aria-hidden="false">
    <div class="mySlides fade"><img src="https://kerelalottery.ct.ws/wp-content/uploads/2025/05/img.jpg" alt="Slide 1"></div>
    <div class="mySlides fade"><img src="https://kerelalottery.ct.ws/wp-content/uploads/2025/05/imag.jpg" alt="Slide 2"></div>
    <div class="mySlides fade"><img src="https://kerelalottery.ct.ws/wp-content/uploads/2025/05/akshaya1.jpg" alt="Slide 3"></div>
  </div>

  <!-- feedback / winners -->
  <section class="lottery-container" aria-label="Winner feedback">
    <div class="feedback-container">
      <div class="feedback-track" id="feedbackTrack">
        <!-- sample cards -->
        <div class="feedback-card">
          <div class="winner-badge">WINNER</div>
          <div class="user-info"><div class="avatar">RK</div><div class="user-details"><h4>Rajesh Kumar</h4><p>From Kochi</p></div></div>
          <div class="feedback-text">"Just won â‚¹7,50,000 in Karunya KR-625! Payment received in 5 days."</div>
          <div class="lottery-details"><span class="prize-amount">â‚¹7,50,000</span><span class="timestamp"></span></div>
        </div>

        <div class="feedback-card">
          <div class="winner-badge">JACKPOT</div>
          <div class="user-info"><div class="avatar">PM</div><div class="user-details"><h4>Priya Menon</h4><p>From Thiruvananthapuram</p></div></div>
          <div class="feedback-text">"Won â‚¹25,00,000 in Christmas Bumper. Everything verified officially."</div>
          <div class="lottery-details"><span class="prize-amount">â‚¹25,00,000</span><span class="timestamp"></span></div>
        </div>

        <div class="feedback-card">
          <div class="winner-badge">WINNER</div>
          <div class="user-info"><div class="avatar">SK</div><div class="user-details"><h4>Sunil Kumar</h4><p>From Kozhikode</p></div></div>
          <div class="feedback-text">"Finally won â‚¹1,20,000 in Win-Win after 3 years."</div>
          <div class="lottery-details"><span class="prize-amount">â‚¹1,20,000</span><span class="timestamp"></span></div>
        </div>

        <div class="feedback-card">
          <div class="winner-badge">WINNER</div>
          <div class="user-info"><div class="avatar">DP</div><div class="user-details"><h4>Deepa P.</h4><p>From Wayanad</p></div></div>
          <div class="feedback-text">"â‚¹60,000 in Sthree Sakthi."</div>
          <div class="lottery-details"><span class="prize-amount">â‚¹60,000</span><span class="timestamp"></span></div>
        </div>

      </div>
    </div>

    <div class="live-indicator"><div class="live-dot" aria-hidden="true"></div><span>LIVE WINNER UPDATES</span></div>

    <div class="controls">
      <button class="control-btn" onclick="pauseAnimation()">Pause</button>
      <button class="control-btn" onclick="playAnimation()">Play</button>
    </div>

    <div class="disclaimer">*These are testimonials from verified winners. Results may vary. Please play responsibly.</div>
  </section>

</div> <!-- page-wrap -->

<!-- Floating WhatsApp button (side icon) -->
<a id="whatsappFloat" class="whatsapp-float" href="#" target="_blank" rel="noopener" aria-label="Chat on WhatsApp" title="Chat on WhatsApp">
  <!-- WhatsApp SVG -->
  <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
    <path d="M20.52 3.48A11.88 11.88 0 0 0 12 .75C6.21.75 1.5 5.46 1.5 11.25c0 1.99.53 3.92 1.54 5.62L1 23l6.42-2.02A11.5 11.5 0 0 0 12 22.75c5.79 0 10.5-4.71 10.5-10.5 0-1.9-.53-3.7-1.98-5.77z" fill="#fff" opacity=".08"/>
    <path d="M16.47 14.35c-.26-.13-1.53-.75-1.77-.83-.24-.09-.42-.13-.6.13-.17.26-.67.83-.82 1-.15.17-.3.19-.56.06-.26-.13-1.09-.4-2.08-1.28-.77-.65-1.29-1.45-1.44-1.71-.15-.26-.02-.4.11-.53.11-.11.24-.3.36-.45.12-.15.16-.26.26-.43.09-.17.04-.32-.02-.45-.06-.12-.6-1.45-.82-1.99-.22-.52-.45-.45-.62-.46l-.53-.01c-.18 0-.45.06-.69.32-.24.25-.92.9-.92 2.2 0 1.29.94 2.54 1.07 2.72.13.17 1.84 3 4.46 4.1 3.11 1.29 3.11.86 3.67.81.56-.05 1.53-.63 1.75-1.24.22-.61.22-1.13.15-1.24-.07-.12-.26-.17-.52-.3z" fill="#fff"/>
  </svg>
</a>

<!-- SCRIPTS -->
<script>
/* ---------- CONFIG ---------- */
const TICKET_PRICE = 150;
const MIN_TICKETS = 1;

// Elements
const ticket = document.getElementById("ticket"),
      selectedList = document.getElementById("selectedList"),
      freeList = document.getElementById("freeList"),
      amount = document.getElementById("amount"),
      ticketAmount = document.getElementById("ticketAmount"),
      breakdown = document.getElementById("breakdown"),
      submitBtn = document.getElementById("submitBtn"),
      counter = document.getElementById("counter"),
      nameI = document.getElementById("name"),
      mobileI = document.getElementById("mobile"),
      stateSelect = document.getElementById("state"),
      previewModal = document.getElementById("previewModal"),
      previewContent = document.getElementById("previewContent"),
      whatsappFloat = document.getElementById("whatsappFloat");

/* ---------- Populate state select with custom order ---------- */
(function populateStates(){
  // top five first (in given order)
  const topStates = ["Kerala","Tamil Nadu","Karnataka","Andhra Pradesh","Telangana"];

  // all indian states/UTs (simple list). You can add/remove if needed.
  const all = [
    "Andhra Pradesh","Arunachal Pradesh","Assam","Bihar","Chhattisgarh","Goa","Gujarat",
    "Haryana","Himachal Pradesh","Jharkhand","Karnataka","Kerala","Madhya Pradesh",
    "Maharashtra","Manipur","Meghalaya","Mizoram","Nagaland","Odisha","Punjab",
    "Rajasthan","Sikkim","Tamil Nadu","Telangana","Tripura","Uttar Pradesh",
    "Uttarakhand","West Bengal","Andaman and Nicobar Islands","Chandigarh","Dadra and Nagar Haveli and Daman and Diu",
    "Delhi","Jammu and Kashmir","Ladakh","Lakshadweep","Puducherry"
  ];

  // Build unique list: put topStates first (if present), then remaining from 'all' excluding topStates
  const remaining = all.filter(s=> !topStates.includes(s));
  const finalList = [...topStates, ...remaining];

  // add placeholder first
  stateSelect.innerHTML = '<option value="">Select State</option>';
  finalList.forEach(s=>{
    const opt = document.createElement('option');
    opt.value = s;
    opt.textContent = s;
    stateSelect.appendChild(opt);
  });
})();

/* ---------- populate 100 sample tickets ---------- */
for(let i=0;i<100;i++){
  let n=("000000"+Math.floor(Math.random()*999999)).slice(-6);
  let o=document.createElement("option");
  o.value="KL"+n; o.textContent="KL"+n;
  ticket.appendChild(o);
}

/* ---------- BUNDLE CALC ----------
 New rule implemented:
  - Use 5-packs (each 5 paid => 2 free)
  - For remainder: if remainder >= 2 then give +1 free (so 2,3,4 all give 1 extra free when not part of 5-pack)
  This prevents two separate 2-packs from doubling freebies incorrectly for 4 (4 => only 1 free).
*/
function calculateBundle(paid){
  if(!paid || paid < 1) return {price:0, free:0, bd:{fives:0, twos:0, ones:0}};
  const fives = Math.floor(paid / 5);
  const rem = paid - (fives * 5);

  // if remainder is 2 or more (2,3,4), give one extra free (but only one)
  const twos = (rem >= 2) ? 1 : 0;

  const ones = rem - (twos * 2); // informational
  const free = (fives * 2) + (twos * 1);
  const price = paid * TICKET_PRICE;
  return { price, free, bd:{ fives, twos, ones } };
}

/* generate unique free tickets not colliding with selected paid ones */
function generateFreeTickets(free, existing){
  let tickets = new Set(existing);
  let newTickets = [];
  while(newTickets.length < free){
    let n = ("000000"+Math.floor(Math.random()*999999)).slice(-6);
    let code = "KL"+n;
    if(!tickets.has(code)){
      newTickets.push(code);
      tickets.add(code);
    }
  }
  return newTickets;
}

/* ---------- REFRESH UI ---------- */
function refresh(){
  let sel = [...ticket.selectedOptions].map(o=>o.value);
  let paid = sel.length;
  let {price, free, bd} = calculateBundle(paid);

  counter.textContent = `Selected: ${paid} paid tickets Â· Free: ${free}`;
  selectedList.innerHTML = "";
  sel.forEach(t=>{
    let c = document.createElement("div");
    c.className = "chip";
    c.innerHTML = `${t} <span onclick="removeTicket('${t}')" aria-hidden="true">Ã—</span>`;
    selectedList.appendChild(c);
  });

  let freeTickets = [];
  if(paid >= MIN_TICKETS){
    amount.value = "â‚¹ " + price;
    ticketAmount.style.display = "block";
    ticketAmount.textContent = `ðŸ’° Total Amount: â‚¹ ${price} (for ${paid} paid + ${free} free)`;

    // generate free tickets deterministically: to avoid flicker, use seeded generation based on paid count + selected IDs
    freeTickets = generateFreeTickets(free, sel);
    freeList.innerHTML = "";
    freeTickets.forEach(t=>{
      let c = document.createElement("div");
      c.className = "chip";
      c.innerHTML = `${t}`;
      freeList.appendChild(c);
    });

    breakdown.style.display = "block";
    breakdown.innerHTML = `Paid: ${paid}<br>Free: ${free}<br>Total Tickets: ${paid+free}<br>Price Breakdown: ${bd.fives} x (5-pack â‚¹750 +2 free), ${bd.twos} x (2-pack threshold gives 1 free when remainder â‰¥ 2), ${bd.ones} x (single â‚¹150)<br>Grand Total: â‚¹${price}`;
  } else {
    amount.value = "";
    ticketAmount.style.display = "block";
    ticketAmount.textContent = "ðŸ’° Minimum 1 ticket required";
    freeList.innerHTML = "";
    breakdown.style.display = "none";
    breakdown.innerHTML = "";
  }

  const canSubmit = (paid >= MIN_TICKETS) && nameI.value.trim().length>0 && mobileI.value.trim().length>0 && stateSelect.value.trim().length>0;
  submitBtn.disabled = !canSubmit;
  submitBtn.setAttribute('aria-disabled', submitBtn.disabled ? 'true' : 'false');

  return {sel, freeTickets, price, paid, free, bd};
}

ticket.addEventListener("change", refresh);
[nameI, mobileI, stateSelect].forEach(i=>i.addEventListener("input", refresh));

window.removeTicket = (t) => {
  [...ticket.options].forEach(o=>{ if(o.value===t) o.selected=false; });
  refresh();
};

/* ---------- SUBMIT / PREVIEW / WHATSAPP ---------- */
let isSubmitting = false;
submitBtn.onclick = () => {
  if(isSubmitting) return;
  isSubmitting = true;
  try{ fbq('track','Lead'); } catch(e){}
  let {sel, freeTickets, price, paid, free, bd} = refresh();
  previewContent.innerHTML = `
<b>Name:</b> ${escapeHtml(nameI.value)}
<b>Mobile:</b> ${escapeHtml(mobileI.value)}
<b>State:</b> ${escapeHtml(stateSelect.value)}

<b>Paid Tickets:</b> ${paid}
<b>Free Tickets:</b> ${free}
<b>Total Delivered:</b> ${paid+free}

<b>Selected Tickets (Paid):</b>
${sel.join('\n')}

<b>Free Tickets:</b>
${freeTickets.join('\n')}

<b>Price Breakdown:</b> ${bd.fives} x (5-pack â‚¹750 +2 free), ${bd.twos} x (2-pack threshold), ${bd.ones} x (single â‚¹150)
<b>Total Amount:</b> â‚¹${price}

<b>Payment Mode:</b> WhatsApp Confirmation
âš ï¸ Please verify details before proceeding.
  `;
  previewModal.style.display = "flex";
};

function closePreview(){ previewModal.style.display = "none"; isSubmitting = false; }

function openWhatsApp(prefilledMsg){
  const number = "+918406997885";
  const url = "https://wa.me/" + number.replace(/\D/g,'') + "?text=" + encodeURIComponent(prefilledMsg);
  window.open(url, "_blank");
}

function proceedWhatsApp(){
  let {sel, freeTickets, price, paid, free} = refresh();
  let tickets = sel.concat(freeTickets).join(", ");
  let msg = `New Booking\nName: ${nameI.value}\nMobile: ${mobileI.value}\nState: ${stateSelect.value}\n\nTickets:\n${tickets}\n\nTotal Tickets: ${paid + free}\nAmount: â‚¹${price}`;
  openWhatsApp(msg);
  previewModal.style.display = "none";
  isSubmitting = false;
}

/* Floating WhatsApp button click -> opens chat */
whatsappFloat.addEventListener('click', (e)=>{
  e.preventDefault();
  const nm = nameI.value.trim() || 'New customer';
  const mb = mobileI.value.trim() || '';
  const msg = `Hello, I want to book tickets.\nName: ${nm}\nMobile: ${mb}\nPlease assist.`;
  openWhatsApp(msg);
});

/* ---------- SLIDESHOW ---------- */
let slideIndex = 1;
function showSlides(){
  let slides = document.getElementsByClassName("mySlides");
  for(let i=0;i<slides.length;i++) slides[i].style.display = "none";
  slideIndex++;
  if(slideIndex>slides.length) slideIndex=1;
  if(slides[slideIndex-1]) slides[slideIndex-1].style.display = "block";
  setTimeout(showSlides,3000);
}
showSlides();

/* ---------- FEEDBACK TRACK ---------- */
const track = document.getElementById('feedbackTrack');
let isPlaying = true;
let userPaused = false;
function pauseAnimation(){ if(track) { track.style.animationPlayState='paused'; isPlaying=false; userPaused=true; } }
function playAnimation(){ if(track) { track.style.animationPlayState='running'; isPlaying=true; userPaused=false; } }
if(track){
  track.addEventListener('mouseenter', ()=>{ if(isPlaying){ track.style.animationPlayState='paused'; track.dataset.hoverPaused = 'true'; }});
  track.addEventListener('mouseleave', ()=>{ if(track.dataset.hoverPaused === 'true'){ if(!userPaused) track.style.animationPlayState='running'; delete track.dataset.hoverPaused; }});
}
function randomTimestamp(){ const m = Math.floor(Math.random()*300); if(m<60) return m+" min ago"; if(m<1440) return Math.floor(m/60)+" hrs ago"; return new Date().toLocaleDateString('en-IN'); }
function updateTimestamps(){ document.querySelectorAll('.timestamp').forEach(ts => ts.textContent = randomTimestamp()); }

/* Setup seamless scroll */
function setupScrolling(){
  if(!track) return;
  if(track.dataset.cloned === 'true') return;
  const children = Array.from(track.children);
  if(children.length === 0) return;
  let total = 0;
  children.forEach(card=>{
    const style = getComputedStyle(card);
    const mr = parseFloat(style.marginRight) || 12;
    total += card.offsetWidth + mr;
  });
  const originalHTML = track.innerHTML;
  track.innerHTML = originalHTML + originalHTML;
  track.dataset.cloned = 'true';
  const pxPerSec = 220;
  let duration = Math.max(8, Math.round(total / pxPerSec));
  duration = Math.min(Math.max(duration, 8), 50);
  const styleTag = document.createElement('style');
  styleTag.id = 'feedback-scroll-style';
  styleTag.innerHTML = `@keyframes feedbackScroll { 0% { transform: translateX(0); } 100% { transform: translateX(-${total}px); } }`;
  document.head.appendChild(styleTag);
  track.style.animation = `feedbackScroll ${duration}s linear infinite`;
  track.style.willChange = 'transform';
  const mq = window.matchMedia('(prefers-reduced-motion: reduce)');
  if(mq.matches){ track.style.animationPlayState = 'paused'; isPlaying = false; }
}
setupScrolling();
updateTimestamps();
setInterval(updateTimestamps, 300000);

/* Utilities */
function escapeHtml(text){ if(!text) return ''; return text.replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; }); }

/* Init UI */
refresh();
</script>

</body>
</html>
