<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Kerala Government Ticket</title>
<style>
:root{--accent:#ff4f79;--accent-dark:#d9365d;--bg:#fff3f7;--card:#fff;}
body{margin:0;background:var(--bg);font-family:Arial,sans-serif;display:flex;justify-content:center;padding:8px;}
.container{width:100%;max-width:400px;background:var(--card);padding:14px;border-radius:14px;box-shadow:0 4px 8px rgba(0,0,0,.14);}
.topLogo img{width:130px;display:block;margin:0 auto 4px;}
.livePop{display:inline-block;padding:6px 14px;border-radius:20px;background:linear-gradient(90deg,#2ecc71,#27ae60);color:#fff;font-size:12px;font-weight:bold;animation:pulse 1.2s infinite;}
@keyframes pulse{0%{transform:scale(1);}50%{transform:scale(1.05);}100%{transform:scale(1);}}
.timerBar{background:#e8f5e9;color:#1b5e20;padding:6px;border-radius:8px;font-size:12px;text-align:center;font-weight:bold;margin-bottom:6px;}
h2{text-align:center;margin:6px 0;color:#d9365d;font-size:18px;}
input,select,button{width:100%;padding:9px;margin-bottom:8px;border-radius:8px;border:1px solid #ddd;font-size:13px;}
.ticketBox{border:2px dashed #ff4f79;border-radius:12px;padding:10px;margin-bottom:8px;}
.ticketAmount{background:#e8f5e9;color:#1b5e20;padding:6px;border-radius:8px;text-align:center;font-weight:bold;margin-bottom:6px;font-size:13px;}
.ticketTitle{font-weight:bold;color:#d9365d;margin-bottom:4px;font-size:13px;}
select[multiple]{height:55px;}
.counter{font-size:11px;margin-top:3px;}
.selectedList{display:flex;flex-wrap:wrap;gap:5px;margin-top:5px;}
.chip{background:#ffe3ea;color:#d9365d;padding:3px 7px;border-radius:10px;font-size:11px;display:flex;align-items:center;gap:5px;}
.chip span{cursor:pointer;font-weight:bold;}
button{background:linear-gradient(90deg,var(--accent),var(--accent-dark));color:#fff;border:none;font-weight:bold;cursor:pointer;font-size:14px;}
button:disabled{opacity:.5;cursor:not-allowed;}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;}
.modalBox{background:#fff;width:92%;max-width:360px;border-radius:14px;padding:16px;}
.modalBox h3{text-align:center;color:#d9365d;margin:0 0 10px;}
.summary{font-size:13px;line-height:1.6;}
.modalBtns{display:flex;gap:10px;margin-top:12px;}
.modalBtns button{flex:1;}
.cancelBtn{background:#ccc;color:#333;}

/* Bottom popup (new) */
.notif-wrapper{
  position:fixed;
  left:16px;
  bottom:18px;
  z-index:9999;
  display:flex;
  flex-direction:column;
  gap:8px;
  pointer-events:none;
  max-width:320px;
}
.notif{
  pointer-events:auto;
  background:linear-gradient(90deg, rgba(255,79,121,0.06), rgba(217,54,93,0.02));
  border:1px solid rgba(217,54,93,0.12);
  color:#333;
  padding:10px 12px;
  border-radius:12px;
  box-shadow:0 8px 18px rgba(0,0,0,0.12);
  display:flex;
  gap:10px;
  align-items:center;
  transform:translateY(14px);
  opacity:0;
  animation:slideIn 420ms ease forwards;
  font-size:13px;
  min-width:220px;
  backdrop-filter: blur(4px);
}
.notif.hide { animation:slideOut 360ms ease forwards; }
@keyframes slideIn{ from{opacity:0; transform:translateY(14px) translateX(-6px) scale(.98);} to{opacity:1; transform:translateY(0) translateX(0) scale(1);} }
@keyframes slideOut{ from{opacity:1; transform:translateY(0);} to{opacity:0; transform:translateY(18px) scale(.98);} }

.notif .avatar{
  width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent-dark));color:#fff;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:13px;flex-shrink:0;
}
.notif .body{flex:1;line-height:1.1;}
.notif .body .who{font-weight:700;font-size:13px;color:#d9365d;}
.notif .body .mobile{font-size:12px;color:#555;margin-top:2px;}
.notif .body .state{font-size:12px;color:#333;margin-top:2px;font-weight:600;}
.notif .body .msg{margin-top:6px;font-size:13px;color:#333;}
.notif .closeBtn{margin-left:8px;border:none;background:transparent;color:#666;font-size:16px;cursor:pointer;padding:6px;border-radius:8px;}
.notif .closeBtn:focus{outline:2px solid rgba(0,0,0,.06);}

/* floating whatsapp button on right (uses provided image) */
.wa-float{
  position:fixed;
  right:16px;
  bottom:18px;
  z-index:10001;
  width:56px;height:56px;border-radius:50%;box-shadow:0 8px 20px rgba(0,0,0,0.18);overflow:hidden;background:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;
}
.wa-float img{width:100%;height:100%;object-fit:cover;display:block;}

/* small responsive tweak */
@media (max-width:420px){
  .notif-wrapper{left:8px;right:8px;max-width:calc(100% - 16px);}
  .wa-float{right:12px;bottom:12px;width:48px;height:48px;}
}
</style>
</head>

<body>
<div class="container">

<div style="text-align:center;margin-bottom:6px;">
<span class="livePop">üü¢ LIVE BOOKING ACTIVE</span>
</div>

<div class="timerBar" id="timer">‚è≥ Booking closes in 30:00</div>

<h2>Kerala Government Ticket</h2>

<input id="name" placeholder="Full Name">
<input id="mobile" placeholder="Mobile Number">

<select id="state">
  <option value="">Select State</option>
  <option>Kerala</option>
  <option>Tamil Nadu</option>
  <option>Karnataka</option>
  <option>Andhra Pradesh</option>
  <option>Telangana</option>
</select>

<select id="language">
<option>English</option>
<option>Hindi</option>
<option>Malayalam</option>
<option>Tamil</option>
<option>Kannada</option>
<option>Telugu</option>
</select>

<div class="ticketBox">
<div class="ticketAmount" id="ticketAmount">üí∞ Total Amount: ‚Çπ0</div>
<div class="ticketTitle">üéü Select Lucky Ticket (‚Çπ40 per ticket)</div>
<select id="ticket" multiple></select>
<div class="counter" id="counter">Selected: 0 tickets</div>
<div class="selectedList" id="selectedList"></div>
</div>

<input id="amount" placeholder="Total Amount (‚Çπ)" readonly>
<button id="submitBtn" disabled>Submit & Continue</button>

</div>

<!-- Bottom notification wrapper -->
<div class="notif-wrapper" id="notifWrapper" aria-live="polite"></div>

<!-- Floating WhatsApp (uses provided image) -->
<div class="wa-float" id="waFloat" title="Chat on WhatsApp">
  <img src="https://kerelalottery.ct.ws/wp-content/uploads/2026/02/whatsapp.jpg" alt="whatsapp">
</div>

<div class="modal" id="previewModal">
  <div class="modalBox">
    <h3>Payment Preview</h3>
    <div class="summary" id="previewContent"></div>
    <div class="modalBtns">
      <button class="cancelBtn" onclick="closePreview()">Cancel</button>
      <button onclick="proceedWhatsApp()">Confirm & WhatsApp</button>
    </div>
  </div>
</div>

<script>
/* ---------- CONFIG: change number here and it updates both places ---------- */
const WHATSAPP_NUMBER = "+919576398992"; // -> change here to update everywhere
const WHATSAPP_IMG_URL = "https://kerelalottery.ct.ws/wp-content/uploads/2026/02/whatsapp.jpg";

/* ---------- existing script (timer + tickets) ---------- */
let time=1800;
setInterval(()=>{
 let m=Math.floor(time/60),s=time%60;
 document.getElementById("timer").textContent=`‚è≥ Booking closes in ${m}:${s.toString().padStart(2,"0")}`;
 if(time>0) time--;
},1000);

const TICKET_PRICE=40,MIN_TICKETS=3;
const ticket=document.getElementById("ticket"),
selectedList=document.getElementById("selectedList"),
amount=document.getElementById("amount"),
ticketAmount=document.getElementById("ticketAmount"),
submitBtn=document.getElementById("submitBtn"),
counter=document.getElementById("counter"),
language=document.getElementById("language"),
stateSelect=document.getElementById("state"),
nameI=document.getElementById("name"),
mobileI=document.getElementById("mobile"),
previewModal=document.getElementById("previewModal"),
previewContent=document.getElementById("previewContent");

for(let i=0;i<3000;i++){
 let n=("000000"+Math.floor(Math.random()*999999)).slice(-6);
 let o=document.createElement("option");
 o.value="KL"+n;o.textContent="KL"+n;
 ticket.appendChild(o);
}

/* Add remaining states under the existing top ones (avoid duplicates) */
const moreStates = [
  "Maharashtra","Gujarat","Rajasthan","Punjab","Haryana","Bihar","Uttar Pradesh",
  "Madhya Pradesh","Chhattisgarh","Odisha","West Bengal","Assam",
  "Arunachal Pradesh","Manipur","Meghalaya","Mizoram","Nagaland","Sikkim","Tripura",
  "Jammu & Kashmir","Ladakh","Delhi","Goa","Puducherry","Andaman & Nicobar",
  "Dadra and Nagar Haveli and Daman & Diu","Lakshadweep"
];
// append only if not present
const existVals = [...stateSelect.options].map(o=>o.textContent.trim());
moreStates.forEach(s=>{
  if(!existVals.includes(s)){
    let o=document.createElement("option");
    o.textContent=s;
    stateSelect.appendChild(o);
  }
});

function refresh(){
 let sel=[...ticket.selectedOptions].map(o=>o.value);
 counter.textContent=`Selected: ${sel.length} tickets`;
 selectedList.innerHTML="";
 sel.forEach(t=>{
   let c=document.createElement("div");
   c.className="chip";
   c.innerHTML=`${t} <span onclick="removeTicket('${t}')">√ó</span>`;
   selectedList.appendChild(c);
 });
 if(sel.length>=MIN_TICKETS){
   let total=sel.length*TICKET_PRICE;
   amount.value="‚Çπ "+total;
   ticketAmount.textContent="üí∞ Total Amount: ‚Çπ "+total;
 }else{
   amount.value="";
   ticketAmount.textContent="üí∞ Minimum 3 tickets required";
 }
 submitBtn.disabled=!(sel.length>=3 && nameI.value && mobileI.value && stateSelect.value);
}

ticket.addEventListener("change",refresh);
[nameI,mobileI,stateSelect].forEach(i=>i.addEventListener("input",refresh));

window.removeTicket=(t)=>{
 [...ticket.options].forEach(o=>{if(o.value===t) o.selected=false;});
 refresh();
};

submitBtn.onclick=()=>{
 let sel=[...ticket.selectedOptions].map(o=>o.value).join(", ");
 previewContent.innerHTML=`
<b>Name:</b> ${nameI.value}<br>
<b>Mobile:</b> ${mobileI.value}<br>
<b>State:</b> ${stateSelect.value}<br><br>
<b>Tickets Selected:</b><br>${sel}<br><br>
<b>Total Tickets:</b> ${ticket.selectedOptions.length}<br>
<b>Price per Ticket:</b> ‚Çπ40<br>
<b>Total Amount:</b> ${amount.value}<br><br>
<b>Payment Mode:</b> WhatsApp Confirmation<br>
‚ö†Ô∏è Please verify details before proceeding.
 `;
 previewModal.style.display="flex";
};

function closePreview(){previewModal.style.display="none";}

function proceedWhatsApp(){
 let tickets=[...ticket.selectedOptions].map(o=>o.value).join(", ");
 let msg=`New Booking
Name: ${nameI.value}
Mobile: ${mobileI.value}
State: ${stateSelect.value}

Tickets:
${tickets}

Total Tickets: ${ticket.selectedOptions.length}
Amount: ${amount.value}
Language: ${language.value}`;
 // sanitize number for wa.me
 const numClean = WHATSAPP_NUMBER.replace(/\D/g,'');
 window.open("https://wa.me/"+numClean+"?text="+encodeURIComponent(msg),"_blank");
 previewModal.style.display="none";
}

/* ---------- NEW: bottom rotating popup notifications (with states & bias to south) ---------- */

/* South-leaning names (bigger list) */
const southNames = [
  "arun","vignesh","karthik","praveen","srinivas","ajith","rajesh","kumar","santhosh","venkat",
  "arjun","rajeshwar","manoj","mukesh","hari","dinesh","satish","girish","rahul","naveen",
  "sudheer","ganesh","mohan","madhu","anu","prasanna","balaji","sujith","amar","sreekanth"
];
/* a few non-south to keep it realistic */
const otherNames = ["ankit","deepak","sumit","atul","sandeep","raj","aman","sourav","amit","ravi"];
/* combine with heavier weight for south */
const allNamesWeighted = [...southNames, ...southNames, ...southNames, ...otherNames]; // south x3 weight

/* Messages/templates (use {T}) */
const templates = [
  "Just booked {T}",
  "WIN ‚Çπ5 Lakh on {T}",
  "BOOKED {T}",
  "Lucky! {T} - Congrats",
  "Hurry, grabbed {T}",
  "{T} confirmed!",
  "KL{T} ‚Äî Booked now",
  "Booked for family: {T}",
  "Don't miss {T}",
  "Winner alert: {T}"
];

/* All states list (used for random notification state; bias toward south) */
const southStates = ["Kerala","Tamil Nadu","Karnataka","Andhra Pradesh","Telangana","Puducherry","Goa"];
const otherStates = ["Maharashtra","Gujarat","Rajasthan","Punjab","Haryana","Bihar","Uttar Pradesh",
  "Madhya Pradesh","Chhattisgarh","Odisha","West Bengal","Assam",
  "Arunachal Pradesh","Manipur","Meghalaya","Mizoram","Nagaland","Sikkim","Tripura",
  "Jammu & Kashmir","Ladakh","Delhi","Andaman & Nicobar","Dadra and Nagar Haveli and Daman & Diu","Lakshadweep"];
const allStatesWeighted = [...southStates, ...southStates, ...southStates, ...otherStates];

/* util: random ticket */
function randTicket(){
  return (Math.floor(Math.random()*900000)+100000); // 100000..999999
}

/* util: masked mobile generator ‚Äî returns +91 XXxxxx1234 style */
function randMobileMasked(){
  const first = [9,8,7][Math.floor(Math.random()*3)];
  const next = Math.floor(Math.random()*10);
  let last4 = ("" + (Math.floor(Math.random()*9000)+1000));
  const firstTwo = "" + first + next;
  return "+91 " + firstTwo + "xxxx" + last4;
}

/* show a notification element for a short time */
const notifWrapper = document.getElementById("notifWrapper");

function showOneNotif(opts = {}, displayMs = 5000){
  const n = document.createElement("div");
  n.className = "notif";

  const avatar = document.createElement("div");
  avatar.className = "avatar";
  avatar.textContent = opts.initials || (opts.name ? opts.name[0].toUpperCase() : "S");

  const body = document.createElement("div");
  body.className = "body";
  body.innerHTML = `<div class="who">${opts.name}</div>
                    <div class="mobile">${opts.mobile}</div>
                    <div class="state">${opts.state}</div>
                    <div class="msg">${opts.message}</div>`;

  const close = document.createElement("button");
  close.className = "closeBtn";
  close.setAttribute("aria-label","close");
  close.innerHTML = "‚úï";
  close.onclick = () => {
    n.classList.add("hide");
    setTimeout(()=>{ n.remove(); }, 420);
  };

  n.appendChild(avatar);
  n.appendChild(body);
  n.appendChild(close);

  notifWrapper.appendChild(n);

  setTimeout(()=>{
    n.classList.add("hide");
    setTimeout(()=>{ n.remove(); }, 420);
  }, displayMs);
}

/* Scheduler: every 3.5s show a new one, each notif stays ~5.2s */
let cycleIntervalMs = 3500;
function startNotifCycle(){
  generateAndShow();
  window._notifTimer = setInterval(() => {
    generateAndShow();
  }, cycleIntervalMs);
}

/* Generate random notification data and show */
function generateAndShow(){
  const name = allNamesWeighted[Math.floor(Math.random()*allNamesWeighted.length)];
  const displayName = name.charAt(0).toUpperCase() + name.slice(1);
  const ticket = "KL" + randTicket();
  const tpl = templates[Math.floor(Math.random()*templates.length)];
  const message = tpl.includes("{T}") ? tpl.replace("{T}", ticket) : tpl + " " + ticket;
  const mobile = randMobileMasked();
  const state = allStatesWeighted[Math.floor(Math.random()*allStatesWeighted.length)];
  showOneNotif({ name: displayName, mobile, message, state }, 5200);
}

/* Start cycle when page loaded */
document.addEventListener("DOMContentLoaded", ()=>{
  // ensure floating wa image uses configured URL (in case changed)
  const waFloat = document.getElementById("waFloat");
  waFloat.querySelector("img").src = WHATSAPP_IMG_URL;

  startNotifCycle();
});

/* Stop showing notifications while user focuses inputs (safer UX) */
[nameI, mobileI].forEach(el=>{
  el.addEventListener("focus", ()=> {
    if(window._notifTimer) {
      clearInterval(window._notifTimer);
      window._notifTimer = null;
    }
  });
  el.addEventListener("blur", ()=> {
    if(!window._notifTimer) startNotifCycle();
  });
});

/* Floating whatsapp click uses same WHATSAPP_NUMBER */
document.getElementById("waFloat").addEventListener("click", ()=>{
  const numClean = WHATSAPP_NUMBER.replace(/\D/g,'');
  // prefill a small message
  const msg = "Hi, I want to book tickets.";
  window.open("https://wa.me/"+numClean+"?text="+encodeURIComponent(msg), "_blank");
});
</script>
</body>
</html>
